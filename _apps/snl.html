---
layout: wide
title: SNL Spectrum Viewer
---
    <script src="https://cdn.jsdelivr.net/npm/vega@5.17.0"></script>
<!--     <script src="https://cdn.jsdelivr.net/npm/vega-lite@4.17.0"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.0.0/build/vega-lite.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.12.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-themes@2.9.1" onload="loadThemes()"></script>
   <link href="/static/jsoneditor.css" rel="stylesheet" type="text/css">
<script src="/static/jsoneditor.js"></script>
<style>
.json-formatter-row .json-formatter-string,
.json-formatter-row .json-formatter-stringifiable{
	color: teal;
	white-space: normal;
	word-wrap: break-word;
	}
</style>
    
    <div class="ui teal label"> 
                        <i class="paint brush icon"></i> 
                        Theme
                        <select class="ui teal dropdown" id="theme"> </select>
                      </div>
    <div class="card bg-primary text-white">
	    <div id="view" class="column card-body bg-light text-dark"></div>	    
	    <div class="card-body bg-light text-dark" id="vegaspec"> </div>
	    <div class="card-body bg-light text-dark" id="vegadata"> </div>
    </div>
<button class="ui float right teal button" name="saveButton" onclick="UpdatePlot()">Update </button>	     
<div class="ui divider"></div>  
   
                <div id="output" style="height: 500px;background-color: rgba(202, 244, 247);"> </div>
 
<script>
	
	$(document).ready(function() {

   window.onload = function(){
    
      console.log("Did window load");
	loadThemes("theme"); 
	initvegaspecs();

   };
});

	
	 
	var ploteditor;
	var vegaspec;
	function initvegaspecs(){
	
		fetch("/vg/freqsnl.json").then(d=>d.json()).then(
			
			d=>{				
			console.log(d);
			vegaspec=d;
			ploteditor = new JSONEditor(document.getElementById('vegaspec'), { mode: 'code', modes: ['code', 'form', 'text', 'tree', 'view', 'preview'], maxVisibleChilds: 25 }, vegaspec);
	}
								);
	
// 		var vegaspec =
//         {
//             $schema: 'https://vega.github.io/schema/vega-lite/v5.json',
//             data: {
//                 values: [
//                     { a: 'C', b: 2 },
//                     { a: 'C', b: 7 },
//                     { a: 'C', b: 4 },
//                     { a: 'D', b: 1 },
//                     { a: 'D', b: 2 },
//                     { a: 'D', b: 6 },
//                     { a: 'E', b: 8 },
//                     { a: 'E', b: 4 },
//                     { a: 'E', b: 7 }
//                 ]
//             },
//             mark: 'bar',
//             encoding: {
//                 y: { field: 'a', type: 'nominal' },
//                 x: {
//                     aggregate: 'average',
//                     field: 'b',
//                     type: 'quantitative',
//                     axis: {
//                         title: 'Average of b'
//                     }
//                 }
//             }
//         };
// ploteditor = new JSONEditor(document.getElementById('vegaspec'), { mode: 'code', modes: ['code', 'form', 'text', 'tree', 'view', 'preview'], maxVisibleChilds: 25 }, vegaspec);
        
	}
	
	function loadThemes() {
	var elname="theme";
        var keys = [];
        selectobj = document.getElementById(elname);

        for (var k in vegaThemes) {
            if (typeof (vegaThemes[k]) == "object") {
                var option = document.createElement("option");
                option.text = k;
                if (k == 'fivethirtyeight') {
                    option.setAttribute('selected', "selected");
                }

                selectobj.add(option);
                // console.log("Adding theme ",k)  ;
            }

        }

    }
	
	 function CallPlots() {
        vegaspec = ploteditor.get();


        // optional argument passed to Vega-Embed to specify Vega-Lite spec. More info at https://github.com/vega/vega-embed
        var opt = {
            "mode": "vega-lite"
        };

        // Embed the visualization in the container with id `vis`
        vegaEmbed("#view", vegaspec, opt).then(function (result) {
            // Callback receiving the View instance and parsed Vega spec
            // result.view is the View, which resides under the '#vis' element
        }).catch(console.warn);


    }

	
function UpdatePlot() {
        el = document.getElementById('output');
        //  editor = new JSONEditor(el, {mode:'view',modes: ['code', 'form', 'text', 'tree', 'view', 'preview'], maxVisibleChilds:25}, objspec);
        themename = document.getElementById("theme").value;
        var objspec = editor.get();
   //     var id_token = guser.getAuthResponse().id_token;
    //    myHeaders.set('Authorization', 'Bearer ' + id_token);
      //  const myloader = { http: { headers: myHeaders } };
      
      
      vegaEmbed('#vis2', objspec, { renderer: "canvas", "loader": myloader, "actions": { "export": true, "source": false, "compiled": false, "editor": false }, "theme": themename, "downloadFileName": "ISRO Frequency", patch: (s) => {
	      
//         vegaEmbed('#vis2', objspec, { renderer: "canvas", "loader": myloader, "actions": { "export": true, "source": false, "compiled": false, "editor": false }, "theme": themename, "downloadFileName": "ISRO Frequency", patch: (s) => {
         
         s.signals.push({
 "name": "barClick",
 "value": 0,
 
 "on": [  {"events": "rect:mousedown", "encode": "select"},
{"events": "rect:mouseup", "encode": "release"} ]
});

         console.log("patch function is ",s);
         return s;                 
     } })
     .then(function (result) {
         // Access the Vega view instance (https://vega.github.io/vega/docs/api/view/) as result.view
         console.log("Vega Embed result ", result);
         console.log("Vega View ", result.view);
         vegaview = result.view;
         vegaview.addSignalListener('barClick', myListener);
     }).catch(console.error);

    //    vegaEmbed('#vis2', objspec, { "loader": myloader, "actions": { "export": true, "source": false, "compiled": false, "editor": false }, "theme": themename, "downloadFileName": "ISRO Frequency" });
    }
   
	  
 
    
  
</script>
